# Система контроля качества для проекта AiSync.me

## Содержание

1. [Введение](#введение)
2. [Чекпоинты (контроль версий)](#чекпоинты-контроль-версий)
3. [Тестирование](#тестирование)
   - [Юнит-тесты](#юнит-тесты)
   - [E2E-тесты](#e2e-тесты)
   - [Визуальное тестирование](#визуальное-тестирование)
4. [Проверка логов консоли](#проверка-логов-консоли)
5. [Скриншоты UI](#скриншоты-ui)
6. [Автоматизация](#автоматизация)
   - [GitHub Actions](#github-actions)
   - [Pre-commit хуки](#pre-commit-хуки)
7. [Рекомендации по использованию](#рекомендации-по-использованию)

## Введение

Система контроля качества для проекта AiSync.me обеспечивает стабильность, надежность и высокое качество кода. Она включает в себя инструменты для создания чекпоинтов, тестирования, проверки логов консоли и создания скриншотов UI.

## Чекпоинты (контроль версий)

Для управления версиями кода используется Git. Каждое изменение в проекте создает чекпоинт, который можно использовать для восстановления предыдущего состояния.

### Основные команды Git

```bash
# Создание новой ветки для фичи
git checkout -b feature/название-фичи

# Сохранение изменений
git add .
git commit -m "Описание изменений"

# Отправка изменений в удаленный репозиторий
git push origin feature/название-фичи

# Восстановление предыдущего состояния
git checkout <хеш-коммита>

# Отмена изменений
git revert <хеш-коммита>
```

### Рекомендации по работе с Git

1. Создавайте отдельную ветку для каждой новой функции или исправления
2. Используйте осмысленные сообщения коммитов, описывающие внесенные изменения
3. Регулярно синхронизируйте свою ветку с основной веткой (main)
4. Используйте pull request для слияния изменений в основную ветку

## Тестирование

### Юнит-тесты

Для юнит-тестирования используется Jest. Тесты находятся в директории `apps/web/__tests__`.

#### Запуск юнит-тестов

```bash
# Запуск всех тестов
npm run test

# Запуск тестов в режиме watch
npm run test:watch

# Запуск тестов с отчетом о покрытии
npm run test:coverage

# Запуск тестов только для компонентов UI
npm run test:ui
```

### E2E-тесты

Для E2E-тестирования используется Playwright. Тесты находятся в директории `tests/e2e`.

#### Запуск E2E-тестов

```bash
# Запуск всех E2E-тестов
npm run test:e2e

# Запуск E2E-тестов с UI
npm run test:e2e:ui

# Просмотр отчета о E2E-тестах
npm run test:e2e:report
```

### Визуальное тестирование

Для визуального тестирования компонентов используется Storybook. Истории компонентов находятся в директории `.storybook`.

#### Запуск Storybook

```bash
# Запуск Storybook
npm run storybook

# Сборка Storybook
npm run build-storybook
```

## Проверка логов консоли

В E2E-тестах реализована проверка логов консоли. Тесты будут падать, если в консоли появляются ошибки.

```typescript
// Пример проверки логов консоли в Playwright
test('должна загружаться без ошибок в консоли', async ({ page }) => {
  // Массив для сбора ошибок консоли
  const consoleErrors: string[] = [];
  
  // Слушаем события консоли
  page.on('console', (msg) => {
    if (msg.type() === 'error') {
      consoleErrors.push(`Ошибка консоли: ${msg.text()}`);
    }
  });

  // Переходим на страницу
  await page.goto('/');
  
  // Проверяем, что в консоли нет ошибок
  expect(consoleErrors.length).toBe(0, `Обнаружены ошибки в консоли: ${consoleErrors.join('\n')}`);
});
```

## Скриншоты UI

Скриншоты UI создаются автоматически при выполнении E2E-тестов. Они сохраняются в директории `tests/e2e/screenshots`.

```typescript
// Пример создания скриншота в Playwright
await page.screenshot({ path: 'tests/e2e/screenshots/login-page.png', fullPage: true });
```

## Автоматизация

### GitHub Actions

GitHub Actions используется для автоматизации процесса тестирования и деплоя. Конфигурация находится в файле `.github/workflows/main.yml`.

#### Основные задачи GitHub Actions

1. Запуск юнит-тестов
2. Запуск E2E-тестов
3. Создание скриншотов UI
4. Деплой на Vercel

### Pre-commit хуки

Pre-commit хуки используются для запуска тестов и линтинга перед каждым коммитом. Конфигурация находится в файлах `.husky/pre-commit` и `.lintstagedrc.js`.

#### Основные задачи pre-commit хуков

1. Запуск линтинга для измененных файлов
2. Запуск тестов для измененных компонентов
3. Проверка форматирования кода

## Рекомендации по использованию

1. **Всегда запускайте тесты перед коммитом**. Pre-commit хуки сделают это автоматически, но лучше запустить тесты заранее, чтобы избежать проблем.

2. **Регулярно просматривайте отчеты о покрытии**. Это поможет выявить непокрытые тестами участки кода.

3. **Используйте TDD (разработку через тестирование)**. Сначала пишите тесты, затем реализуйте функциональность.

4. **Проверяйте скриншоты UI после каждого изменения**. Это поможет выявить визуальные регрессии.

5. **Следите за логами консоли**. Ошибки в консоли могут указывать на проблемы, которые не видны на первый взгляд.

6. **Используйте чекпоинты для восстановления**. Если что-то пошло не так, всегда можно вернуться к предыдущему состоянию.

7. **Документируйте изменения в CHANGELOG.md**. Это поможет отслеживать историю изменений проекта.

8. **Обновляйте тесты при изменении функциональности**. Устаревшие тесты могут давать ложные результаты.

9. **Используйте GitHub Actions для автоматизации**. Это сэкономит время и повысит качество кода.

10. **Регулярно обновляйте зависимости**. Это поможет избежать проблем с безопасностью и совместимостью.
